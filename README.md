# reperr

Веб-приложение для автоматической обработки ошибок информационных баз, работающих на платформе 1С:Предприятие 8.3.17+

## Содержание

- [Введение](#введение)
- [Возможности](#возможности)
- [Установка и запуск](#установка%20и%20запуск)
- [Настройка](#настройка)
- [Ограничения](#ограничения)
- [Планы по развитию](#планы%20по%20развитию)
- [Обратная связь и доработка](#обратная%20связь%20и%20доработка)
- [Зависимости](#зависимости)
- [Авторы](#авторы)

## Введение

Название `reperr` образовано от **rep**ort и **err**or, произносится как **рэпер** :v:

Веб-приложение создано для автоматической обработки ошибок, которые возникают в информационных базах на платформе 1С:Предприятие версий 8.3.17+.
Позволяет автоматически регистрировать ошибки во внешнем баг-трекере, с указанием имени и версии конфигурации, стека вызовов, скриншотом окна и прочей информацией, которая передается клиентским приложением.

## Возможности

- Сохранение запросов информации об ошибках, которые направляет клиентское приложение.
- Распаковка поступающих отчетов об ошибках.
- Автоматическая регистрация ошибок в баг-трекере (Jira, Redmine).
- Отображение Ид задачи из баг-трекера прямо в окне 1С, если такая ошибка уже была зарегистрирована там ранее.
- Запрет повторной регистрации одной и той же ошибки.
- Отправка сообщений с информацией об ошибке в точку обмена RabbitMQ.
- Отправка сообщений с информацией об ошибке в Sentry.

## Установка и запуск

### Запуск в docker-контейнере

- клонировать текущий репозиторий
- внести изменения в `src/appsettings.json` [(подробнее)](#настройка)
- перейти в каталог `src/` проекта
- выполнить команду `opm install -l` для установки локальных зависимостей
- перейти в каталог проекта в командной строке
- выполнить команду `'docker build -t <tag> .'`, где:
  - `<tag>` - метка образа, задается произвольно
- выполнить команду `'docker run -d --name <name> -v <localPath>:<dockerPath> -p <port>:5000 <tag>'`, где:
  - `<name>` - имя контейнера, задается произвольно
  - `<localPath>` - локальный каталог, в котором будут храниться данные приложения
  - `<dockerPath>` - каталог внутри контейнера, в который изначально записываются данные приложения (устанавливается в `appsettings.json`)
  - `<port>` - локальный порт, на котором будет доступно приложение
  - `<tag>` - метка образа, заданная на предыдущем шаге
- убедиться, что веб-интерфейс открывается в браузере
- настроить информационные базы для работы с приложением [(подробнее)](#настройка)

Пример:

Фрагмент `appsettings.json`:

```json
"DataStorage":{
            "file": {
                "enabled": true,
                "path": "data"
            }
        }
```

`docker build -t reperr .`

`docker run --name reperr -v C:\Users\IIvanov\reperr-data:/app/data -p 1222:5000 reperr`

### Ручная установка и запуск

- распаковать [OneScript.Web](https://github.com/EvilBeaver/OneScript.Web/releases) в любой локальный каталог
- клонировать текущий репозиторий
- внести изменения в `src/appsettings.json` [(подробнее)](#настройка)
- перейти в каталог `src/` проекта
- выполнить команду `opm install -l` для установки локальных зависимостей
- запустить `OneScript.WebHost.exe` (находится в каталоге, куда был распакован [OneScript.Web](http://web.oscript.io/))
- убедиться, что веб-интерфейс открывается в браузере
- настроить информационные базы для работы с приложением [(подробнее)](#настройка)

## Настройка

Все параметры приложения расположены в файле `src/appsettings.json`.

URL, по которому доступно приложение, надо указать в информационных базах, которые планируется подключить к сервису (Функции для технического специалиста - Стандартные - Управление настройками обработки ошибок - Адрес сервиса регистрации ошибок).

Раздел `reperrSettings` включает в себя все остальные настройки:

Подразделы `DataStorage` и `Integrations` содежат список поддерживаемых хранилищ данных и баг-трекеров соответственно. Приложение считывает эти настройки в момент запуска и использует **первый** активированный способ (`"enabled": true`).

## Требования

- [OneScript.Web](http://web.oscript.io/) 0.7.0 (на других версиях работоспособность не проверялась)
- 1С:Предприятие 8.3.17+ (в более младших версиях отсутствуют необходимые [возможности](https://its.1c.ru/db/v8317doc#bookmark:dev:TI000002264) платформы)

## Ограничения

- ошибки регистрируются в баг-трекере от имени владельца API-ключа, а не от лица пользователя информационной базы.
- веб-интерфейс пока почти полностью состоит из заглушек.
- какие-либо ограничения доступа на уровне веб-приложения отсутствуют. Любой, кто сможет открыть веб-интерфейс, сможет просматривать всю информацию.
- на данный момент приложение опубликовано в статусе альфа версии. Обратная совместимость в последующих версиях не гарантируется.
- отправка присоединенных файлов в точку обмена RabbitMQ пока не поддерживается.

## Планы по развитию

- настройка приложения с нуля через веб-интерфейс
- передача API-ключей для баг-трекеров через переменные окружения
- поддержка СППР ред. 1 и 2 в качестве баг-трекера
- гибкая настройка параметров регистрации ошибок
  - определение необходимости регистрации ошибки
  - кастомизация сообщения, которое выводится пользователю
- перевод приложения на библиотеку [entity](https://github.com/oscript-library/entity)
  - поддержка хранения данных во внешней БД
- аутентификация пользователей веб-приложения

## Обратная связь и доработка

Опишите ваш вопрос \ пожелание в виде Issue.

Разработка ведется по git-flow, PR крайне приветствуются.

Архитектура приложения позволяет относительно легко добавить свой баг-трекер и чуть сложнее - собственное хранилище данных (планируется перевод приложения на [entity](https://github.com/oscript-library/entity)).

## Зависимости

- [OneScript.Web](http://web.oscript.io/)
- [json](https://github.com/oscript-library/json)
- [1connector](https://github.com/oscript-library/1connector)
- [RabbitMQ](https://github.com/oscript-library/RabbitMQ)

Спасибо авторам и контрибьюторам!

## Авторы

- [Дмитрий Овчаренко](https://github.com/ovcharenko-di)
